/*! This is uglify test - 2015-06-23 */app.api.add("getProduct","http://"+config.sour+":8888/",{model:"product",action:"get"},"get"),app.api.add("editClient","http://"+config.sour+":8888/",{model:"client",action:"edit"},"get"),app.api.add("checkUser","http://"+config.sour+":8888/",{model:"client",action:"checkUser"},"get"),app.api.add("checkUserName","http://"+config.sour+":8888/",{model:"client",action:"checkUserName"},"get"),app.api.add("checkPhone","http://"+config.sour+":8888/",{model:"client",action:"checkPhone"},"get"),app.api.add("checkEmail","http://"+config.sour+":8888/",{model:"client",action:"checkEmail"},"get"),app.api.add("login","http://"+config.sour+":8888/",{model:"client",action:"login"},"get"),app.api.add("register","http://"+config.sour+":8888/",{model:"client",action:"register"},"get"),app.api.add("resetKey","http://"+config.sour+":8888/",{model:"client",action:"resetKey"},"get"),app.api.add("getBind","http://"+config.sour+":8888/",{model:"client",action:"getBind"},"get"),app.api.add("getBindCode","http://"+config.sour+":8888/",{model:"client",action:"getBindCode"},"get"),app.api.add("bind","http://"+config.sour+":8888/",{model:"client",action:"bind"},"get"),app.api.add("getSafeQusetion","http://"+config.sour+":8888/",{model:"client",action:"getSafeQusetion"},"get"),app.api.add("setSafeQusetion","http://"+config.sour+":8888/",{model:"client",action:"setSafeQusetion"},"get"),app.api.add("checkSafeQusetion","http://"+config.sour+":8888/",{model:"client",action:"checkSafeQusetion"},"get"),app.api.add("getannouncement","http://"+config.sour+":8888/",{model:"announcement",action:"get"},"get"),app.api.add("getrecruit","http://"+config.sour+":8888/",{model:"recruit",action:"get"},"get"),app.api.add("getcompany","http://"+config.sour+":8888/",{model:"company",action:"get"},"get"),app.api.add("getpromotion","http://"+config.sour+":8888/",{model:"promotion",action:"get"},"get"),app.api.add("redPacketDetail","http://"+config.sour+":8888/",{model:"redPacket",action:"detail"},"get"),app.api.add("adddeal","http://"+config.sour+":8888/",{model:"deal",action:"add"},"get"),app.api.add("editdeal","http://"+config.sour+":8888/",{model:"deal",action:"edit"},"get"),app.api.add("getdealList","http://"+config.sour+":8888/",{model:"deal",action:"list"},"get"),app.api.add("getConfig","http://"+config.sour+":8888/",{model:"config",action:"get"},"get"),function(a){a.set({name:"FAQS",par:"a/b/f/e/k",tem:["FAQS"],fn:function(a){app.cookies("user")?$("#leftButton").hide():($("#leftButton").show(),$("#leftButton").html("登录"),$("#leftButton").unbind("tap").bind("tap",function(){window.location.hash="index"})),$("#centerTitle").html("常见问题"),$("#rightButton").html("注册"),$("#rightButton").unbind("tap").bind("tap",function(){window.location.hash="register"}),app.api.run("getpromotion",null,function(b){var c=[];$.each(b,function(a,b){"FAQS"==b.group&&c.push(b)}),console.log(c);var d=_.template(a.tem[0])({data:c});$("#scroller").html(d),myScroll.refresh()},function(){alert("获取信息失败")})}})}(app.control),function(a){a.set({name:"about",par:"a/b/f/e/k",tem:["about"],fn:function(a){app.cookies("user")?$("#leftButton").hide():($("#leftButton").show(),$("#leftButton").html("登录"),$("#leftButton").unbind("tap").bind("tap",function(){window.location.hash="index"})),$("#centerTitle").html("关于我们"),$("#rightButton").html("注册"),$("#rightButton").unbind("tap").bind("tap",function(){window.location.hash="register"}),$("#scroller").html(a.tem[0]),$("#scroller").find("[D_type='navPoint']").each(function(){$(this).unbind("tap").bind("tap",function(){window.location.hash=$(this).attr("D_data")})}),myScroll.refresh()}})}(app.control),function(a){a.set({name:"account",par:"a/b/f/e/k",tem:["account"],fn:function(a){$("#leftButton").hide(),$("#centerTitle").html("个人中心"),$("#rightButton").html("返回"),$("#rightButton").unbind("tap").bind("tap",function(){window.history.go(-1)}),app.cookies("user")?($("#scroller").html(a.tem[0]),$("#scroller").find("[D_type='navPoint']").each(function(){$(this).unbind("tap").bind("tap",function(){window.location.hash=$(this).attr("D_data")})}),myScroll.refresh()):(alert("请先登录"),window.location.hash="index")}})}(app.control),function(a){a.set({name:"announcement",par:"a/b/f/e/k",tem:["announcement"],fn:function(a){app.cookies("user")?$("#leftButton").hide():($("#leftButton").show(),$("#leftButton").html("登录"),$("#leftButton").unbind("tap").bind("tap",function(){window.location.hash="index"})),$("#centerTitle").html("企业公告"),$("#rightButton").html("返回"),$("#rightButton").unbind("tap").bind("tap",function(){window.history.go(-1)}),app.api.run("getannouncement",null,function(b){console.log(b);var c=_.template(a.tem[0])({data:b});$("#scroller").html(c),myScroll.refresh()},function(){alert("获取公告信息失败")})}})}(app.control),function(a){a.set({name:"buy",par:"id/count/f/e/k",tem:["buy"],fn:function(a){$("#leftButton").hide(),$("#centerTitle").html("请确认购买"),$("#rightButton").html("返回"),$("#rightButton").unbind("tap").bind("tap",function(){window.history.go(-1)}),app.api.run("getProduct",null,function(b){b=_.indexBy(b,"id"),console.log(b[a.id]);var c={id:uuid(),productId:a.id,userId:app.cookies("user").id,title:b[a.id].title,subhead:b[a.id].subhead,count:Number(a.count),startTime:(new Date).getTime(),buyPrice:b[a.id].UnitPrice,endTime:null,sellPrice:null},d=_.template(a.tem[0])({data:c});$("#scroller").html(d),myScroll.refresh(),$("#scroller").find("button").unbind("tap").bind("tap",function(){app.api.run("adddeal",c,function(){alert("交易成功"),window.location.hash="goodList"},function(){alert("交易失败")})})},function(){alert("获取交易信息失败")})}})}(app.control),function(a){a.set({name:"card",par:"a/b/f/e/k",tem:["card"],fn:function(a){$("#scroller").html(a.tem[0]),myScroll.refresh()}})}(app.control),function(a){a.set({name:"change",par:"id/count/f/e/k",tem:["change"],fn:function(a){function b(b){app.api.run("getProduct",null,function(c){c=_.indexBy(c,"id"),console.log(c[b.productId]),b.sellPrice=c[b.productId].UnitPrice,b.title=c[b.productId].title,b.subhead=c[b.productId].subhead,b.change=c[b.productId].change;var d=_.template(a.tem[0])({data:b});$("#scroller").html(d),myScroll.refresh(),$("#scroller").find("[D_type='changebutton']").unbind("tap").bind("tap",function(){function a(){app.apis.editdeal(b,function(){alert("转移成功"),window.location.hash="account"},function(){alert("转移失败")})}app.apis.checkUserName($("[D_data='changeMember']").val(),function(c){b.userId=c[0].id,a()},function(){alert("找不到该用户")})})},function(){alert("获取交易信息失败")})}$("#leftButton").hide(),$("#centerTitle").html("请确认转让"),$("#rightButton").html("返回"),$("#rightButton").unbind("tap").bind("tap",function(){window.history.go(-1)}),app.api.run("getdealList",app.cookies("user").id,function(c){c=_.indexBy(c,"id"),b(c[a.id])},function(){alert("获取交易信息失败")})}})}(app.control),function(a){a.set({name:"company",par:"a/b/f/e/k",tem:["company"],fn:function(a){app.cookies("user")?$("#leftButton").hide():($("#leftButton").show(),$("#leftButton").html("登录"),$("#leftButton").unbind("tap").bind("tap",function(){window.location.hash="index"})),$("#centerTitle").html("公司信息"),$("#rightButton").html("返回"),$("#rightButton").unbind("tap").bind("tap",function(){window.history.go(-1)}),app.api.run("getcompany",null,function(b){console.log(b);var c=_.template(a.tem[0])({data:b});$("#scroller").html(c),myScroll.refresh()},function(){alert("获取企业信息失败")})}})}(app.control),function(a){a.set({name:"contact",par:"a/b/f/e/k",tem:["contact"],fn:function(a){app.cookies("user")?$("#leftButton").hide():($("#leftButton").show(),$("#leftButton").html("登录"),$("#leftButton").unbind("tap").bind("tap",function(){window.location.hash="index"})),$("#centerTitle").html("联系方式"),$("#rightButton").html("注册"),$("#rightButton").unbind("tap").bind("tap",function(){window.location.hash="register"}),$("#scroller").html(a.tem[0]),myScroll.refresh()}})}(app.control),function(a){a.set({name:"dealList",par:"a/b/f/e/k",tem:["dealList"],fn:function(a){function b(b){app.api.run("getdealList",app.cookies("user").id,function(c){c&&_.each(c,function(a){a.title=b[a.productId].title,a.subhead=b[a.productId].subhead,a.minUnit=b[a.productId].minUnit}),console.log(c);var d=_.template(a.tem[0])({data:c});$("#scroller").html(d),myScroll.refresh()},function(){alert("获取交易信息失败")})}$("#leftButton").hide(),$("#centerTitle").html("收支记录"),$("#rightButton").html("返回"),$("#rightButton").unbind("tap").bind("tap",function(){window.history.go(-1)}),app.api.run("getProduct",null,function(a){a=_.indexBy(a,"id"),b(a)},function(){alert("获取商品信息失败")})}})}(app.control),function(a){a.set({name:"email",par:"a/b/f/e/k",tem:["email"],fn:function(a){$("#leftButton").hide(),$("#centerTitle").html("绑定邮箱"),$("#rightButton").html("返回"),$("#rightButton").unbind("tap").bind("tap",function(){window.history.go(-1)});var b=app.cookies("user");app.api.run("getBind",b.id,function(c){function d(){$("#scroller").find("button").html("绑定"),$("#scroller").find("button").unbind("tap").bind("tap",function(){var a={type:"email",number:$("#scroller").find("input").val()};app.api.run("getBindCode",a,function(){$("#scroller").find("button").unbind("tap");var a=30,b=setInterval(function(){$("#scroller").find("button").html(a+"秒后可重新发送"),a--,0>a&&(clearInterval(b),d())},1e3)},function(){alert("发送失败")})})}b.bind=c;var e=_.template(a.tem[0])({data:b});$("#scroller").html(e),myScroll.refresh(),d()},function(){alert("获取绑定信息失败")})}})}(app.control),function(a){a.set({name:"goodDetail",par:"id/b/f/e/k",tem:["goodDetail"],fn:function(a){app.cookies("user")?$("#leftButton").hide():($("#leftButton").show(),$("#leftButton").html("登录"),$("#leftButton").unbind("tap").bind("tap",function(){window.location.hash="index"})),$("#centerTitle").html("产品详情"),$("#rightButton").html("返回"),$("#rightButton").unbind("tap").bind("tap",function(){window.history.go(-1)}),app.api.run("getProduct",null,function(b){b=_.indexBy(b,"id"),console.log(b[a.id]);var c=_.template(a.tem[0])({data:b[a.id]});$("#scroller").html(c),myScroll.refresh(),$(".carousel").carousel(),$("#scroller").find("[D_type='buybutton']").unbind("tap").bind("tap",function(){app.cookies("user")?window.location.hash="buy/"+a.id+"/"+$("#crowdCount").val():(alert("请先登录再购买"),window.location.hash="login")})},function(){alert("获取交易信息失败")})}})}(app.control),function(a){a.set({name:"goodList",par:"a/b/f/e/k",tem:["goodList"],fn:function(a){function b(b){app.api.run("getdealList",app.cookies("user").id,function(c){c&&_.each(c,function(a){a.title=b[a.productId].title,a.subhead=b[a.productId].subhead,a.minUnit=b[a.productId].minUnit}),console.log(c),app.api.run("getConfig",function(b){var d=_.template(a.tem[0])({data:c,config:b});$("#scroller").html(d),myScroll.refresh(),$("#scroller").find("[D_type='sellButton']").unbind("tap").bind("tap",function(){window.location.hash="sell/"+$(this).attr("D_data")}),$("#scroller").find("[D_type='changeButton']").unbind("tap").bind("tap",function(){window.location.hash="change/"+$(this).attr("D_data")})},function(){alert("获取配置信息失败")})},function(){alert("获取交易信息失败")})}$("#leftButton").hide(),$("#centerTitle").html("我的众筹"),$("#rightButton").html("返回"),$("#rightButton").unbind("tap").bind("tap",function(){window.history.go(-1)}),app.api.run("getProduct",null,function(a){a=_.indexBy(a,"id"),b(a)},function(){alert("获取商品信息失败")})}})}(app.control),function(a){a.set({name:"idea",par:"a/b/f/e/k",tem:["idea"],fn:function(a){app.cookies("user")?$("#leftButton").hide():($("#leftButton").show(),$("#leftButton").html("登录"),$("#leftButton").unbind("tap").bind("tap",function(){window.location.hash="index"})),$("#centerTitle").html("经营理念"),$("#rightButton").html("返回"),$("#rightButton").unbind("tap").bind("tap",function(){window.history.go(-1)}),app.api.run("getpromotion",null,function(b){var c=[];$.each(b,function(a,b){"idea"==b.group&&c.push(b)}),console.log(c);var d=_.template(a.tem[0])({data:c});$("#scroller").html(d),myScroll.refresh()},function(){alert("获取宣传信息失败")})}})}(app.control),function(a){a.set({name:"index",par:"a/b/f/e/k",tem:["index"],fn:function(a){$("#leftButton").hide(),$("#centerTitle").html("星众众筹"),$("#rightButton").unbind("tap").bind("tap",function(){window.location.hash="register"}),$("#scroller").html(a.tem[0]),myScroll.refresh(),$("#scroller").find("#send").unbind("tap").bind("tap",function(){var a={userName:$("#scroller").find("#userName").val(),passWord:$("#scroller").find("#userPass").val()};app.api.run("login",a,function(a){if(a&&a[0]){if(2==a[0].type)return alert("管理员账号请使用web端登陆"),!1;app.cookies("user",a[0]),window.location.hash="account"}},function(a){alert("账号或密码错误")})})}})}(app.control),function(a){a.set({name:"password",par:"a/b/f/e/k",tem:["password"],fn:function(a){$("#leftButton").hide(),$("#centerTitle").html("重置密码"),$("#rightButton").html("返回"),$("#rightButton").unbind("tap").bind("tap",function(){window.history.go(-1)}),$("#scroller").html(a.tem[0]),myScroll.refresh();var b={id:app.cookies("user").id,oldKey:"",newKey:"",newKey2:""};$("#scroller").find("[D_type='simple']").each(function(){$(this).unbind("change").bind("change",function(){b[$(this).attr("D_data")]=$(this).val()})}),$("#scroller").find("button").unbind("tap").bind("tap",function(){b.newKey&&b.newKey==b.newKey2&&app.api.run("resetKey",b,function(){alert("修改成功"),window.location.hash="account"},function(){alert("修改不成功")})})}})}(app.control),function(a){a.set({name:"phone",par:"a/b/f/e/k",tem:["phone"],fn:function(a){function b(){$("#scroller").find("#btnSendmsg").html("获取验证码"),$("#scroller").find("#btnSendmsg").unbind("tap").bind("tap",function(){app.api.run("getBindCode",{type:"phone",number:$("#phoneNumber").val()},function(a){$("#scroller").find("#btnSendmsg").unbind("touchstart"),alert("信息已发送"),console.log(a),e=a;var c=30,d=setInterval(function(){$("#btnSendmsg").html(c+"秒后可重新发送"),c--,0>c&&(clearInterval(d),b())},1e3)},function(){alert("发送失败")})})}$("#leftButton").hide(),$("#centerTitle").html("绑定手机"),$("#rightButton").html("返回"),$("#rightButton").unbind("tap").bind("tap",function(){window.history.go(-1)});var c=app.cookies("user"),d=_.template(a.tem[0])({data:c});$("#scroller").html(d),myScroll.refresh();var e=!1;b(),$("#scroller").find(".bankcard_confirm").unbind("tap").bind("tap",function(){e&&e==$("#msgValidCode").val()&&app.api.run("bind",{type:"phone",id:c.id,code:e,number:$("#phoneNumber").val()},function(){alert("绑定成功"),c.phone=$("#phoneNumber").val(),app.cookies("user",c),window.location.hash="account"},function(){alert("绑定失败")})})}})}(app.control),function(a){a.set({name:"procedure",par:"a/b/f/e/k",tem:["procedure"],fn:function(a){app.cookies("user")?$("#leftButton").hide():($("#leftButton").show(),$("#leftButton").html("登录"),$("#leftButton").unbind("tap").bind("tap",function(){window.location.hash="index"})),$("#centerTitle").html("筹房流程"),$("#rightButton").html("注册"),$("#rightButton").unbind("tap").bind("tap",function(){window.location.hash="register"}),app.api.run("getpromotion",null,function(b){var c=[];$.each(b,function(a,b){"procedure"==b.group&&c.push(b)}),console.log(c);var d=_.template(a.tem[0])({data:c});$("#scroller").html(d),myScroll.refresh()},function(){alert("获取宣传信息失败")})}})}(app.control),function(a){a.set({name:"product",par:"a/b/f/e/k",tem:["product"],fn:function(a){app.cookies("user")?$("#leftButton").hide():($("#leftButton").show(),$("#leftButton").html("登录"),$("#leftButton").unbind("tap").bind("tap",function(){window.location.hash="index"})),$("#centerTitle").html("选择房源"),$("#rightButton").html("注册"),$("#rightButton").unbind("tap").bind("tap",function(){window.location.hash="register"}),app.api.run("getProduct",null,function(b){app.api.run("getConfig",null,function(c){var d={data:b,config:c},e=_.template(a.tem[0])(d);$("#scroller").html(e),$("#scroller").find(".product").unbind("tap").bind("tap",function(){window.location.hash="goodDetail/"+$(this).attr("id")}),myScroll.refresh()},function(){alert("获取配置信息失败")})},function(){alert("获取商品失败")})}})}(app.control),function(a){a.set({name:"recruit",par:"a/b/f/e/k",tem:["recruit"],fn:function(a){app.cookies("user")?$("#leftButton").hide():($("#leftButton").show(),$("#leftButton").html("登录"),$("#leftButton").unbind("tap").bind("tap",function(){window.location.hash="index"})),$("#centerTitle").html("招贤纳士"),$("#rightButton").html("返回"),$("#rightButton").unbind("tap").bind("tap",function(){window.history.go(-1)}),app.api.run("getrecruit",null,function(b){console.log(b);var c=_.template(a.tem[0])({data:b});$("#scroller").html(c),myScroll.refresh()},function(){alert("获取招聘信息失败")})}})}(app.control),function(a){a.set({name:"register",par:"a/b/f/e/k",tem:["register"],fn:function(a){function b(){$("#scroller").find("#btnSendmsg").html("获取验证码"),$("#scroller").find("#btnSendmsg").unbind("tap").bind("tap",function(){app.api.run("getBindCode",{type:"phone",number:$(this).parents("form").find("[D_data='phone']").val()},function(a){console.log(a),c=a;var d=60;$("#scroller").find("#btnSendmsg").unbind("click"),h=setInterval(function(){$("#btnSendmsg").html(d+"秒后可重新发送验证码"),d--,0==d&&(clearInterval(h),b())},1e3)},function(){alert("发送失败，请检查手机号是否有效")})})}$("#leftButton").hide(),$("#centerTitle").html("请填写基本信息并注册"),$("#rightButton").html("登录"),$("#rightButton").unbind("tap").bind("tap",function(){window.location.hash="index"});var c="",d=!1,e=!1,f=!1,g={id:uuid(),type:1,userName:"",image:"",sex:"1",place:"",phone:"",email:"",name:"",contacts:"",contactsPhone:"",record:"",university:"",job:"",company:"",password:"",password2:"",code:""};$("#scroller").html(a.tem[0]),myScroll.refresh();var h;b(),$("#scroller").find("[D_type='simple']").each(function(a,b){$(this).unbind("change").bind("change",function(){g[$(this).attr("D_data")]=$(this).val()})}),$("#scroller").find("[D_data='userName']").on("change",function(){app.api.run("checkUser",$(this).val(),function(){d=!0},function(){d=!1,alert("账号已注册")})}),$("#scroller").find("[D_data='email']").on("change",function(){app.api.run("checkEmail",$(this).val(),function(){f=!0},function(){f=!1,alert("邮箱已注册")})}),$("#scroller").find("[D_data='phone']").on("change",function(){app.api.run("checkPhone",$(this).val(),function(){e=!0},function(){e=!1,alert("手机已注册")})}),$("#scroller").find("#registerSend").unbind("tap").bind("tap",function(){return d?e?f?c&&c==g.code?void app.api.run("register",g,function(){alert("注册成功"),window.location.hash="login"},function(){alert("err")}):(alert("请填写正确验证码"),!1):(alert("请填写唯一的邮箱"),!1):(alert("请填写唯一的手机号"),!1):(alert("请填写唯一的用户名"),!1)})}})}(app.control),function(a){a.set({name:"sell",par:"id/count/f/e/k",tem:["sell"],fn:function(a){function b(b){app.api.run("getProduct",null,function(c){c=_.indexBy(c,"id"),console.log(c[b.productId]),b.sellPrice=c[b.productId].UnitPrice,b.title=c[b.productId].title,b.subhead=c[b.productId].subhead;var d=_.template(a.tem[0])({data:b});$("#scroller").html(d),myScroll.refresh(),$("#scroller").find("[D_type='sellbutton']").unbind("tap").bind("tap",function(){app.cookies("user")?app.api.run("editdeal",b,function(){alert("交易成功"),window.location.hash="account"},function(){alert("交易失败")}):(alert("请先登录再购买"),window.location.hash="login")})},function(){alert("获取交易信息失败")})}$("#leftButton").hide(),$("#centerTitle").html("请确认出售"),$("#rightButton").html("返回"),$("#rightButton").unbind("tap").bind("tap",function(){window.history.go(-1)}),app.api.run("getdealList",app.cookies("user").id,function(c){c=_.indexBy(c,"id"),b(c[a.id])},function(){alert("获取交易信息失败")})}})}(app.control),function(a){a.set({name:"team",par:"a/b/f/e/k",tem:["team"],fn:function(a){app.cookies("user")?$("#leftButton").hide():($("#leftButton").show(),$("#leftButton").html("登录"),$("#leftButton").unbind("tap").bind("tap",function(){window.location.hash="index"})),$("#centerTitle").html("团队介绍"),$("#rightButton").html("返回"),$("#rightButton").unbind("tap").bind("tap",function(){window.history.go(-1)}),app.api.run("getpromotion",null,function(b){var c=[];$.each(b,function(a,b){"team"==b.group&&c.push(b)}),c=_.indexBy(c,"id"),console.log(c);var d=_.template(a.tem[0])({data:c});$("#scroller").html(d),myScroll.refresh()},function(){alert("获取宣传数据失败")})}})}(app.control),function(a){a.set({name:"userDetail",par:"a/b/f/e/k",tem:["userDetail"],fn:function(a){$("#leftButton").hide(),$("#centerTitle").html("基本信息"),$("#rightButton").html("返回"),$("#rightButton").unbind("tap").bind("tap",function(){window.history.go(-1)});var b=app.cookies("user"),c=_.template(a.tem[0])({data:b});$("#scroller").html(c),myScroll.refresh(),$("#scroller").find("[D_type='simple']").each(function(){$(this).unbind("change").bind("change",function(){b[$(this).attr("D_data")]=$(this).val()})}),$("#scroller").find("[D_type='send']").each(function(){$(this).unbind("tap").bind("tap",function(){app.api.run("editClient",b,function(){alert("修改成功"),app.cookies("user",b),window.location.hash="account"},function(){alert("修改失败")})})})}})}(app.control);